This file is part of mingw-cross-env.
See doc/index.html for further information.

--- OpenCV-2.3.1/CMakeLists.txt.orig	2011-09-12 21:45:38.000000000 +0300
+++ OpenCV-2.3.1/CMakeLists.txt	2011-10-17 20:32:10.000000000 +0300
@@ -349,11 +349,11 @@
     SET(USE_PRECOMPILED_HEADERS OFF CACHE BOOL "Use precompiled headers" FORCE)
 endif()
 
-if(UNIX)
+#if(UNIX)
     include(OpenCVFindPkgConfig.cmake OPTIONAL)
     include(CheckFunctionExists)
     include(CheckIncludeFile)
-endif()
+#endif()
 
 if(CMAKE_COMPILER_IS_GNUCXX)
     set(ENABLE_PROFILING OFF CACHE BOOL "Enable profiling in the GCC compiler (Add flags: -g -pg)")
@@ -404,8 +404,8 @@
 set(WITH_TIFF ON CACHE BOOL "Include TIFF support")
 set(WITH_OPENEXR ON CACHE BOOL "Include ILM support via OpenEXR")
 
-if(UNIX)
     set(WITH_FFMPEG ON CACHE BOOL "Include FFMPEG support")
+if(UNIX)
     if(NOT APPLE)
         set(WITH_UNICAP OFF CACHE BOOL "Include Unicap support (GPL)")
         set(WITH_GTK ON CACHE BOOL "Include GTK support")
@@ -502,6 +502,7 @@
         set(HAVE_PVAPI 1)
       endif()
     endif()
+endif(UNIX)
 
     set(HAVE_FFMPEG 0)
     if(WITH_FFMPEG)
@@ -528,7 +529,7 @@
         FIND_FILE(BZIP2_LIBRARIES NAMES libbz2.so.1 PATHS /lib)
       endif()
     endif()
-
+if(UNIX)
     if(WITH_1394)
       CHECK_MODULE(libdc1394-2 HAVE_DC1394_2)
       if(NOT HAVE_DC1394_2)
@@ -1654,7 +1655,7 @@
 
 # video
 status("")
-if(UNIX AND NOT APPLE)
+#if(UNIX AND NOT APPLE)
     status("  Video I/O:")
     status("    DC1394 1.x:"     HAVE_DC1394         THEN YES ELSE NO)
     status("    DC1394 2.x:"     HAVE_DC1394_2       THEN YES ELSE NO)
@@ -1677,7 +1678,8 @@
             status("    AndroidNativeCamera:" "NO (native camera requires Android API level 8 or higher)")
         endif()
     endif()
-elseif(APPLE)
+#else
+if(APPLE)
     status("  Video I/O:"        WITH_QUICKTIME      THEN QuickTime ELSE QTKit)
 elseif(WIN32)
     status("  Video I/O:"        HAVE_VIDEOINPUT     THEN DirectShow ELSE NO)

--- OpenCV-2.3.1/3rdparty/CMakeLists.txt.orig	2011-10-17 00:14:23.000000000 +0300
+++ OpenCV-2.3.1/3rdparty/CMakeLists.txt	2011-10-17 00:14:04.000000000 +0300
@@ -14,5 +14,5 @@
     add_subdirectory(libtiff)
 endif()
 if(WIN32)
-    add_subdirectory(ffmpeg)
+    #add_subdirectory(ffmpeg)
 endif()

--- OpenCV-2.3.1/modules/highgui/CMakeLists.txt.orig	2011-09-12 21:41:29.000000000 +0300
+++ OpenCV-2.3.1/modules/highgui/CMakeLists.txt	2011-10-17 00:14:49.000000000 +0300
@@ -143,13 +143,13 @@
     if(HAVE_DC1394)
         set(highgui_srcs ${highgui_srcs} src/cap_dc1394.cpp)
     endif()
-
+endif(UNIX)
     if(HAVE_FFMPEG)
         if(BZIP2_LIBRARIES)
             set(HIGHGUI_LIBRARIES ${HIGHGUI_LIBRARIES} ${BZIP2_LIBRARIES})
         endif()
     endif()
-    
+if(UNIX)    
     if(HAVE_PVAPI)
         add_definitions(-DHAVE_PVAPI)
         set(highgui_srcs src/cap_pvapi.cpp ${highgui_srcs})

--- OpenCV-2.3.1/modules/highgui/src/cap_ffmpeg.cpp.orig	2011-09-12 21:41:29.000000000 +0300
+++ OpenCV-2.3.1/modules/highgui/src/cap_ffmpeg.cpp	2011-10-17 00:21:56.000000000 +0300
@@ -63,7 +63,7 @@
     static int ffmpegInitialized = 0;
     if( !ffmpegInitialized )
     {
-    #if defined WIN32 || defined _WIN32
+   /* #if defined WIN32 || defined _WIN32
         const char* module_name = "opencv_ffmpeg"
         #if (defined _MSC_VER && defined _M_X64) || (defined __GNUC__ && defined __x86_64__)
             "_64"
@@ -111,7 +111,7 @@
             }
 #endif
         }
-    #elif defined HAVE_FFMPEG
+    #elif defined HAVE_FFMPEG*/
         icvCreateFileCapture_FFMPEG_p = (CvCreateFileCapture_Plugin)cvCreateFileCapture_FFMPEG;
         icvReleaseCapture_FFMPEG_p = (CvReleaseCapture_Plugin)cvReleaseCapture_FFMPEG;
         icvGrabFrame_FFMPEG_p = (CvGrabFrame_Plugin)cvGrabFrame_FFMPEG;
@@ -121,7 +121,7 @@
         icvCreateVideoWriter_FFMPEG_p = (CvCreateVideoWriter_Plugin)cvCreateVideoWriter_FFMPEG;
         icvReleaseVideoWriter_FFMPEG_p = (CvReleaseVideoWriter_Plugin)cvReleaseVideoWriter_FFMPEG;
         icvWriteFrame_FFMPEG_p = (CvWriteFrame_Plugin)cvWriteFrame_FFMPEG;
-    #endif
+    //#endif
         
         ffmpegInitialized = 1;
     }
@@ -188,11 +188,11 @@
     if( result->open( filename ))
         return result;
     delete result;
-#if defined WIN32 || defined _WIN32
+/*#if defined WIN32 || defined _WIN32
     return cvCreateFileCapture_VFW(filename);
-#else
+#else*/
     return 0;
-#endif    
+//#endif    
 }
 
 
@@ -242,9 +242,9 @@
     if( result->open( filename, fourcc, fps, frameSize, isColor != 0 ))
         return result;
     delete result;
-#if defined WIN32 || defined _WIN32
+/*#if defined WIN32 || defined _WIN32
     return cvCreateVideoWriter_VFW(filename, fourcc, fps, frameSize, isColor);
-#else
+#else*/
     return 0;
-#endif    
+//#endif    
 }

--- OpenCV-2.3.1/samples/cpp/CMakeLists.txt.orig	2011-09-12 21:20:43.000000000 +0300
+++ OpenCV-2.3.1/samples/cpp/CMakeLists.txt	2011-10-17 19:59:43.000000000 +0300
@@ -36,7 +36,7 @@
         add_dependencies(${the_target} opencv_core opencv_flann opencv_imgproc opencv_highgui
             opencv_ml opencv_video opencv_objdetect opencv_features2d
             opencv_calib3d opencv_legacy opencv_contrib)
-        target_link_libraries(${the_target} ${OPENCV_LINKER_LIBS} opencv_core
+        target_link_libraries(${the_target} ${OPENCV_LINKER_LIBS} ${HIGHGUI_LIBRARIES} opencv_core
             opencv_flann opencv_imgproc opencv_highgui opencv_ml opencv_video opencv_objdetect
             opencv_features2d opencv_calib3d opencv_legacy opencv_contrib)
 			
