# From https://github.com/signal11/hidapi
# Commit https://github.com/signal11/hidapi/commit/0d7c7ef066f589de73b1944eb5f9f816d2780fb9
SET(TARGET_NAME "hidapi")
#IF(NOT(UNIX AND NOT APPLE AND NOT LIBUSB_FOUND))
	INCLUDE_DIRECTORIES(${CMAKE_CURRENT_SOURCE_DIR}/hidapi)

	SET(${TARGET_NAME}_HDRS "${CMAKE_CURRENT_SOURCE_DIR}/hidapi/hidapi.h")

	# sources
	IF(APPLE)
		LIST(APPEND ${TARGET_NAME}_SRCS "${CMAKE_CURRENT_SOURCE_DIR}/mac/hid.c")
	ELSEIF(UNIX)
		LIST(APPEND ${TARGET_NAME}_SRCS "${CMAKE_CURRENT_SOURCE_DIR}/libusb/hid.c")
	ELSEIF(WIN32 OR MINGW)
		LIST(APPEND ${TARGET_NAME}_SRCS "${CMAKE_CURRENT_SOURCE_DIR}/windows/hid.c")
	ENDIF()

	# create lib
	ADD_LIBRARY(${TARGET_NAME} ${${TARGET_NAME}_SRCS} ${${TARGET_NAME}_HDRS})

	# link to dependencies
	IF(APPLE)
		TARGET_LINK_LIBRARIES(${TARGET_NAME} "-framework IOKit -framework CoreFoundation")
	ELSEIF(UNIX)
		# NB (linux): requires libusb-1.0, not libusb-0.1 (i.e. don't install libusb-dev)
		TARGET_LINK_LIBRARIES(${TARGET_NAME} ${LIBUSB_LIBRARIES} ${CMAKE_THREAD_LIBS_INIT})
	ELSEIF(WIN32 OR MINGW)
		TARGET_LINK_LIBRARIES(${TARGET_NAME} -lsetupapi)
	ENDIF()

	SET_TARGET_PROPERTIES("${TARGET_NAME}" PROPERTIES FOLDER "${FOLDERNAME}")

	# create test executable
	ADD_EXECUTABLE(hidtest ${CMAKE_CURRENT_SOURCE_DIR}/hidtest/hidtest.cpp)
	TARGET_LINK_LIBRARIES(hidtest ${TARGET_NAME})
	SET_TARGET_PROPERTIES(hidtest PROPERTIES FOLDER "${FOLDERNAME}")

	IF(CMAKE_CAN_APPEND_PROPERTIES)
		SET_PROPERTY(TARGET "${TARGET_NAME}" APPEND PROPERTY INCLUDE_DIRECTORIES "${CMAKE_CURRENT_SOURCE_DIR}/hidapi;${CMAKE_CURRENT_SOURCE_DIR}/src/include")
	ENDIF()

	MESSAGE("[X] ${TARGET_NAME}")
#ELSE()
#	MESSAGE("[ ] ${TARGET_NAME}")
#ENDIF()
